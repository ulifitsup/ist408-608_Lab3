<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simba Lab API Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container my-5">
        <h1 class="text-center">Simba Lab API Interface</h1>
        
        <!-- Authorization Section -->
        <div id="auth-section" class="text-center">
            <form onsubmit="authToken(event)" class="mb-4">
                <h2>Authorization</h2>
                <input type="text" id="client_id" class="form-control" placeholder="Client ID" required>
                <input type="text" id="client_secret" class="form-control mt-2" placeholder="Client Secret" required> 
                <button type="submit" class="btn btn-primary">Get Authorization Token</button>
            </form>
            <p id="token-status" class="mt-3"></p>
        </div>

        <!-- Function Sections (Hidden until authorized) -->
        <div id="function-sections" style="display: none;">
            <h2>Register Member</h2>
            <form onsubmit="registerMember(event)" class="mb-4">
                <input type="text" id="member_name" class="form-control" placeholder="Member Name" required>
                <input type="text" id="member_id" class="form-control mt-2" placeholder="Member ID" required>
                <button type="submit" class="btn btn-success mt-2">Register Member</button>
            </form>

            <h2>Member Deactive</h2>
            <form onsubmit="deactiveMember(event)" class="mb-4">
                <input type="text" id="member_id" class="form-control" placeholder="Member ID" required>
                <button type="submit" class="btn btn-success mt-2">Add Book</button>
            </form>

            <h2>Add New Book</h2>
            <form onsubmit="addNewBook(event)" class="mb-4">
                <input type="text" id="book_name" class="form-control" placeholder="Book Name" required>
                <input type="text" id="ISBN" class="form-control mt-2" placeholder="ISBN" required>
                <button type="submit" class="btn btn-success mt-2">Add Book</button>
            </form>

            <h2>Borrow Book</h2>
            <form onsubmit="borrowBook(event)" class="mb-4">
                <input type="text" id="member_id" class="form-control" placeholder="Member ID" required>
                <input type="text" id="ISBN" class="form-control mt-2" placeholder="ISBN" required>
                <button type="submit" class="btn btn-success mt-2">Add Book</button>
            </form>

            <h2>Return Book</h2>
            <form onsubmit="returnBook(event)" class="mb-4">
                <input type="text" id="member_id" class="form-control" placeholder="Member ID" required>
                <input type="text" id="ISBN" class="form-control mt-2" placeholder="ISBN" required>
                <button type="submit" class="btn btn-success mt-2">Add Book</button>
            </form>

            <h2>Get Book</h2>
            <form onsubmit="getBook(event)" class="mb-4">
                <input type="text" id="isbn_query" class="form-control" placeholder="ISBN" required>
                <button type="submit" class="btn btn-success mt-2">Get Book</button>
            </form>

            <h2>Get Member</h2>
            <form onsubmit="getMember(event)" class="mb-4">
                <input type="text" id="member_id" class="form-control" placeholder="Member ID" required>
                <button type="submit" class="btn btn-success mt-2">Get Member</button>
            </form>
        </div>
    </div>

    <script>
        let token = "";

        function authToken(event) {
            event.preventDefault();
            const clientId = document.getElementById("client_id").value;
            const clientSecret = document.getElementById("client_secret").value;

            axios.post('/api/get_token', {
                client_id: clientId,
                client_secret: clientSecret
            })
                .then(response => {
                    token = response.data.access_token;
                    document.getElementById("token-status").innerText = "Token obtained successfully!";
                    document.getElementById("auth-section").style.display = "none";
                    document.getElementById("function-sections").style.display = "block";
                })
                .catch(error => {
                    console.error("Error fetching token:", error);
                    document.getElementById("token-status").innerText = "Failed to obtain token!";
                });
        }

        function registerMember(event) {
            event.preventDefault();
            const memberName = document.getElementById("member_name").value;
            const memberId = document.getElementById("member_id").value;
            
            axios.post('/api/member_register', {
                token: token,
                member_name: memberName,
                member_id: memberId
            }).then(response => {
                alert("Member registered successfully!");
            }).catch(error => {
                console.error("Error registering member:", error);
            });
        }

        function deactiveMember(event) {
            event.preventDefault();
            const memberId = document.getElementById("member_id").value;
            
            axios.post('/api/member_deactive', {
                token: token,
                member_id: memberId
            }).then(response => {
                alert("Member deactivated successfully!");
            }).catch(error => {
                console.error("Error deactivating member:", error);
            });
        }

        function addNewBook(event) {
            event.preventDefault();
            const bookName = document.getElementById("book_name").value;
            const isbn = document.getElementById("ISBN").value;
            
            axios.post('/api/new_book', {
                token: token,
                book_name: bookName,
                ISBN: isbn
            }).then(response => {
                alert("Book added successfully!");
            }).catch(error => {
                console.error("Error adding book:", error);
            });
        }

        function borrowBook(event) {
            event.preventDefault();
            const memberId = document.getElementById("member_id").value;
            const isbn = document.getElementById("ISBN").value;
            
            axios.post('/api/borrow_book', {
                token: token,
                member_id: memberId,
                ISBN: isbn
            }).then(response => {
                alert("Book borrowed successfully!");
            }).catch(error => {
                console.error("Error borrowing book:", error);
            });
        }

        function returnBook(event) {
            event.preventDefault();
            const memberId = document.getElementById("member_id").value;
            const isbn = document.getElementById("ISBN").value;
            
            axios.post('/api/return_book', {
                token: token,
                member_id: memberId,
                ISBN: isbn
            }).then(response => {
                alert("Book returned successfully!");
            }).catch(error => {
                console.error("Error returning book:", error);
            });
        }

        function getBook(event) {
            event.preventDefault();
            const isbnQuery = document.getElementById("isbn_query").value;
            
            axios.get(`/api/get_book?ISBN=${isbnQuery}`, {
                headers: { Authorization: token }
            }).then(response => {
                alert("Book data: " + JSON.stringify(response.data));
            }).catch(error => {
                console.error("Error fetching book:", error);
            });
        }

        function getMember(event) {
            event.preventDefault();
            const memberId = document.getElementById("member_id").value;
            
            axios.get(`/api/get_member?member_id=${memberId}`, {
                headers: { Authorization: token }
            }).then(response => {
                alert("Member data: " + JSON.stringify(response.data));
            }).catch(error => {
                console.error("Error fetching member:", error);
            });
        }
    </script>
</body>
</html>

